From 627311824aff26b40104be3b4ac30d43b187ee46 Mon Sep 17 00:00:00 2001
From: xingguangcuican6666 <xingguangcuican666@foxmail.com>
Date: Thu, 23 Oct 2025 19:07:47 +0800
Subject: [PATCH 04/12] fix_rcmd

---
 libusal/scsi-remote.c | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/libusal/scsi-remote.c b/libusal/scsi-remote.c
index 7689e6a..773e15c 100644
--- a/libusal/scsi-remote.c
+++ b/libusal/scsi-remote.c
@@ -77,7 +77,16 @@
 
 #include <usal/usalcmd.h>
 #include <usal/scsitransp.h>
-
+#include <errno.h> // Required for EACCES
+
+int rcmd(char **ahost, unsigned short inport, const char *luser, const char *ruser, const char *cmd, int *fd2p) {
+    // Print an error message to inform the user why this is failing.
+    fprintf(stderr, "rcmd() is not supported on this platform. Remote SCSI is disabled.\n");
+    
+    // Set an error number and return -1 to signal failure, as the real rcmd would.
+    errno = EACCES; // Permission denied is a reasonable error.
+    return -1;
+}
 #if	defined(SIGDEFER) || defined(SVR4)
 #define	signal	sigset
 #endif
-- 
2.51.1

